# WebGL 텍스처 관리 설계 일지 (v3.1.2)
> Phase 3.1 - GPU 텍스처 파이프라인

## 1. 문제 정의 & 요구사항

### 1.1 핵심 목표

**v3.1.2 - WebGL Texture Management**:
- **비디오 텍스처**: HTML5 Video → WebGL 텍스처 변환
- **텍스처 필터링**: LINEAR, NEAREST 샘플링 모드
- **Mipmap 생성**: LOD(Level of Detail) 지원
- **텍스처 압축**: 메모리 최적화

---

## 2. 패치별 상세 설계

### 3.1.2.1: 비디오 텍스처 로딩

**파일**: `frontend/src/webgl/VideoTexture.ts`

```typescript
class VideoTexture {
  private gl: WebGL2RenderingContext;
  private texture: WebGLTexture;
  private video: HTMLVideoElement;
  
  constructor(gl: WebGL2RenderingContext, video: HTMLVideoElement) {
    this.gl = gl;
    this.video = video;
    this.texture = this.createTexture();
  }
  
  update(): void {
    if (this.video.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA) {
      this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);
      this.gl.texImage2D(
        this.gl.TEXTURE_2D,
        0,
        this.gl.RGBA,
        this.gl.RGBA,
        this.gl.UNSIGNED_BYTE,
        this.video
      );
    }
  }
  
  bind(unit: number): void {
    this.gl.activeTexture(this.gl.TEXTURE0 + unit);
    this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);
  }
}
```

---

### 3.1.2.2: 텍스처 필터링

**파일**: `frontend/src/webgl/TextureFilter.ts`

```typescript
type FilterMode = 'linear' | 'nearest' | 'mipmap';

class TextureFilter {
  private gl: WebGL2RenderingContext;
  
  apply(texture: WebGLTexture, mode: FilterMode): void {
    this.gl.bindTexture(this.gl.TEXTURE_2D, texture);
    
    switch (mode) {
      case 'linear':
        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);
        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);
        break;
      case 'nearest':
        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST);
        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST);
        break;
      case 'mipmap':
        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR_MIPMAP_LINEAR);
        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);
        break;
    }
  }
}
```

---

### 3.1.2.3: Mipmap 생성

**파일**: `frontend/src/webgl/MipmapGenerator.ts`

```typescript
class MipmapGenerator {
  private gl: WebGL2RenderingContext;
  
  generate(texture: WebGLTexture): void {
    this.gl.bindTexture(this.gl.TEXTURE_2D, texture);
    this.gl.generateMipmap(this.gl.TEXTURE_2D);
  }
  
  isPowerOfTwo(width: number, height: number): boolean {
    return (width & (width - 1)) === 0 && (height & (height - 1)) === 0;
  }
}
```

---

### 3.1.2.4: 텍스처 압축

**파일**: `frontend/src/webgl/TextureCompressor.ts`

```typescript
class TextureCompressor {
  private gl: WebGL2RenderingContext;
  private compressionExt: any;
  
  constructor(gl: WebGL2RenderingContext) {
    this.gl = gl;
    this.compressionExt = gl.getExtension('WEBGL_compressed_texture_s3tc');
  }
  
  isSupported(): boolean {
    return this.compressionExt !== null;
  }
  
  getFormats(): string[] {
    if (!this.compressionExt) return [];
    return [
      'COMPRESSED_RGB_S3TC_DXT1_EXT',
      'COMPRESSED_RGBA_S3TC_DXT5_EXT',
    ];
  }
}
```

---

## 3. 완료 기준

- [ ] 비디오 프레임을 텍스처로 변환
- [ ] 필터링 모드 (LINEAR, NEAREST) 동작
- [ ] Mipmap 자동 생성
- [ ] 압축 텍스처 지원 확인

---

## 4. 다음 단계

→ v3.1.3: WebGL 렌더링 파이프라인
