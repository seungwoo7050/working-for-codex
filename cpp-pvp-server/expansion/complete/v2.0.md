# CLAUDE.md - cpp-pvp-server v2.0 분산 서버 아키텍처

> AI 코딩 에이전트를 위한 프로젝트 컨텍스트 가이드 (분산 아키텍처 전문성 추가)

## 프로젝트 개요

### 선행 조건
- v1.4.0 UDP 넷코드 완료

### 현재 상태 (v1.4.0)
- UDP 기반 단일 서버
- 세션 메모리 저장
- 단일 인스턴스

### 목표 상태 (v2.0.0)
- 분산 서버 아키텍처
- Redis Cluster 세션 저장
- 수평 확장 가능

## 버전 로드맵 (v2.0 세부화)

| 버전 | 기간 | 설명 |
|------|------|------|
| v2.0.0 | 2주 | 세션 서버 분리 및 Redis 통합 |
| v2.0.1 | 2주 | 로드 밸런서 및 Consistent Hashing |
| v2.0.2 | 2주 | 서버 간 통신 및 gRPC |

---

## v2.0.0: 세션 서버 분리 및 Redis 통합

### 작업 내용
| 순서 | 작업 | 핵심 요구사항 |
|------|------|---------------|
| 2.0.0.1 | SessionStore 인터페이스 정의 | 세션 저장 추상화 |
| 2.0.0.2 | RedisSessionStore 구현 | Redis Cluster 지원 |
| 2.0.0.3 | InMemorySessionStore 구현 | 개발/테스트용 |
| 2.0.0.4 | 기존 코드 리팩토링 | 인터페이스 적용 |

### 구현 세부 사항
- 세션 데이터를 Redis Cluster에 저장하여 서버 무상태화
- 연결 풀링 및 Cluster 모드 지원
- 로컬 테스트를 위한 인메모리 구현

---

## v2.0.1: 로드 밸런서 및 Consistent Hashing

### 작업 내용
| 순서 | 작업 | 핵심 요구사항 |
|------|------|---------------|
| 2.0.1.1 | ConsistentHashRing 구현 | 가상 노드 기반 분배 |
| 2.0.1.2 | LoadBalancer 구현 | 세션 어피니티 |
| 2.0.1.3 | 서비스 디스커버리 | Redis pub/sub 기반 |

### 구현 세부 사항
- Consistent Hashing으로 플레이어 고정 할당
- 서버 추가/제거 시 최소 재할당
- 하트비트 기반 서버 상태 모니터링

---

## v2.0.2: 서버 간 통신 및 gRPC

### 작업 내용
| 순서 | 작업 | 핵심 요구사항 |
|------|------|---------------|
| 2.0.2.1 | gRPC 서비스 정의 | 매칭 및 게임 서버 서비스 |
| 2.0.2.2 | MatchmakingService 구현 | 매치 생성/취소 |
| 2.0.2.3 | GameServerService 구현 | 상태 조회 및 이벤트 브로드캐스트 |
| 2.0.2.4 | 이벤트 브로드캐스팅 | 글로벌 이벤트 전파 |

### 구현 세부 사항
- gRPC를 통한 서버 간 통신
- 프로토콜 버퍼 정의
- Redis pub/sub로 이벤트 브로드캐스팅