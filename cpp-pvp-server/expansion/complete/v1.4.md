# CLAUDE.md - cpp-pvp-server v1.4 UDP 넷코드 확장

> AI 코딩 에이전트를 위한 프로젝트 컨텍스트 가이드 (넷코드 전문성 추가)

## 프로젝트 개요

### 선행 조건
- v1.3.0 기본 게임 서버 완료 (WebSocket/TCP 기반 1v1 게임)
- udp-game-sync Track A & B 학습 완료 (기초 TCP/WebSocket + 고급 UDP 넷코드)

### 현재 상태 (v1.3.0)
- **위치**: `/cpp-pvp-server/`
- **기술 스택**: C++17, Boost.Asio/Beast, PostgreSQL, Redis, Protocol Buffers
- **아키텍처**: 단일 서버, WebSocket 기반, 60 TPS 게임 루프
- **완성된 기능**: 1v1 전투, 발사체 물리, 충돌 감지, 데미지 시스템

### 목표 상태 (v1.4.0)
- **목표**: UDP 기반 넷코드 통합
- **핵심 변경**: WebSocket → UDP 전환, 클라이언트 예측/리컨실리에이션 추가
- **가치**: 실시간 게임의 지연 감소, 넷코드 전문성 증명

## 버전 로드맵 (v1.4 세부화)

| 버전 | 기간 | 설명 |
|------|------|------|
| v1.4.0 | 2주 | UDP 권위 서버 코어 & 스냅샷/델타 동기화 |
| v1.4.1 | 2주 | 클라이언트 예측/리컨실리에이션 |
| v1.4.2 | 2주 | 관측성 & 부하 테스트 |

---

## v1.4.0: UDP 권위 서버 코어 & 스냅샷/델타 동기화

### 작업 내용
| 순서 | 작업 | 핵심 파일 | udp-game-sync 참고 |
|------|------|----------|-------------------|
| 1.4.0.1 | UDP 소켓 래퍼 구현 | `UdpSocket.hpp/cpp` | lab1.1-tcp-echo/socket.cpp |
| 1.4.0.2 | UDP 게임 서버 코어 | `UdpGameServer.hpp/cpp` | netcode-core/v1.0/ |
| 1.4.0.3 | 스냅샷/델타 동기화 | `SnapshotManager.hpp/cpp` | netcode-core/v1.1/ |
| 1.4.0.4 | 기존 WebSocket 교체 | `main.cpp` 수정 | - |

### 커밋 포인트
```bash
git commit -m "feat(udp): implement UDP socket wrapper with Boost.Asio"
git commit -m "feat(udp): add UDP game server core with authority model"
git commit -m "feat(udp): implement snapshot-delta synchronization"
git commit -m "refactor(udp): replace WebSocket with UDP in main server loop"
git tag -a v1.4.0 -m "v1.4.0: UDP Netcode Core"
```

### 구현 세부 사항
- **UDP 소켓**: Boost.Asio UDP 소켓으로 비동기 I/O. 패킷 손실/재정렬 처리.
- **권위 모델**: 서버가 게임 상태를 완전히 제어. 클라이언트 입력을 받아 서버에서 검증.
- **스냅샷/델타**: 60 TPS로 게임 상태 스냅샷 전송. 델타로 변경분만 압축 전송.

---

## v1.4.1: 클라이언트 예측/리컨실리에이션

### 작업 내용
| 순서 | 작업 | 핵심 파일 | udp-game-sync 참고 |
|------|------|----------|-------------------|
| 1.4.1.1 | 클라이언트 예측 엔진 | `ClientPrediction.hpp/cpp` | netcode-core/v1.1/ |
| 1.4.1.2 | 리컨실리에이션 시스템 | `Reconciliation.hpp/cpp` | netcode-core/v1.1/ |
| 1.4.1.3 | 입력 버퍼링 | `InputBuffer.hpp/cpp` | netcode-core/v1.1/ |
| 1.4.1.4 | 지연 보상 | `LagCompensation.hpp/cpp` | - |

### 커밋 포인트
```bash
git commit -m "feat(prediction): implement client-side prediction engine"
git commit -m "feat(recon): add server reconciliation with state rewind"
git commit -m "feat(input): add input buffering for consistent simulation"
git commit -m "feat(lag): implement lag compensation for fair gameplay"
git tag -a v1.4.1 -m "v1.4.1: Client Prediction & Reconciliation"
```

### 구현 세부 사항
- **예측**: 클라이언트가 서버 응답 기다리지 않고 로컬 시뮬레이션.
- **리컨실리에이션**: 서버 상태와 클라이언트 예측 불일치 시 보정.
- **지연 보상**: 과거 상태로 되돌려 히트 판정 (예: 발사체 충돌).

---

## v1.4.2: 관측성 & 부하 테스트

### 작업 내용
| 순서 | 작업 | 핵심 파일 | udp-game-sync 참고 |
|------|------|----------|-------------------|
| 1.4.2.1 | UDP 메트릭 추가 | `UdpMetrics.hpp/cpp` | netcode-core/v1.2/ |
| 1.4.2.2 | 패킷 손실 시뮬레이션 | `PacketSimulator.hpp/cpp` | netcode-core/v1.2/ |
| 1.4.2.3 | 재현 가능한 부하 테스트 | `LoadTest.hpp/cpp` | netcode-core/v1.2/ |
| 1.4.2.4 | Grafana 대시보드 | `monitoring/udp-dashboard.json` | - |

### 커밋 포인트
```bash
git commit -m "feat(metrics): add UDP-specific Prometheus metrics"
git commit -m "feat(sim): implement packet loss and latency simulation"
git commit -m "test(load): add reproducible UDP load testing framework"
git commit -m "feat(monitoring): create Grafana dashboard for UDP performance"
git tag -a v1.4.2 -m "v1.4.2: Observability & Load Testing"
```

### 구현 세부 사항
- **메트릭**: 패킷 손실률, RTT, 예측 정확도 측정.
- **부하 테스트**: 다중 클라이언트로 UDP 트래픽 시뮬레이션.
- **관측**: Prometheus/Grafana로 실시간 모니터링.

---

## 포트폴리오 가치
- **넷코드 전문성**: UDP, 예측/리컨실리에이션, 지연 보상을 다룸.
- **실시간 게임 역량**: 지연 민감한 게임 서버 구현 증명.
- **면접 포인트**: "TCP/WebSocket만이 아닌 UDP 넷코드를 구현했다"고 강조.

## 다음 단계
- v1.4 완료 후 v2.0 (분산 서버) 진행.
- udp-game-sync의 CLONE-GUIDE.md를 참고해 구현.