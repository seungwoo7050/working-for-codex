# spring-patterns v2.1 Virtual Threads

## 프로젝트 개요

### 선행 조건
- v2.0 WebFlux & R2DBC 전환 완료
- 리액티브 컨트롤러 및 서비스 구현 완료

### 현재 상태 (v2.0)
- Spring WebFlux
- R2DBC Repository
- SSE 스트리밍

### 목표 상태 (v2.1)
- **Virtual Threads 통합**
- 블로킹 코드 래핑
- 하이브리드 아키텍처

## 버전 로드맵 (v2.1 세부화)

| 버전 | 기간 | 설명 |
|------|------|------|
| v2.1.0 | 0.5주 | Virtual Threads 설정 |
| v2.1.1 | 0.5주 | 블로킹 코드 래핑 |
| v2.1.2 | 0.5주 | 외부 API 병렬 호출 |

---

## v2.1.0: Virtual Threads 설정

### 작업 내용
| 순서 | 작업 | 핵심 파일 |
|------|------|----------|
| 2.1.0.1 | Tomcat Virtual Threads | `application.yml` |
| 2.1.0.2 | VirtualThreadConfig | `VirtualThreadConfig.java` |
| 2.1.0.3 | 스케줄러 설정 | `SchedulerConfig.java` |

### 커밋 포인트
```bash
git commit -m "feat(config): enable Virtual Threads for Tomcat"
git commit -m "feat(config): add VirtualThreadConfig for executors"
git commit -m "feat(config): configure bounded schedulers"
git tag -a v2.1.0 -m "v2.1.0: Virtual Threads Setup"
```

## v2.1.1: 블로킹 코드 래핑

### 작업 내용
| 순서 | 작업 | 핵심 파일 |
|------|------|----------|
| 2.1.1.1 | HybridProductService | `HybridProductService.java` |
| 2.1.1.2 | 블로킹 스케줄러 | `Schedulers.boundedElastic()` |
| 2.1.1.3 | 레거시 통합 | `LegacySystemAdapter.java` |

### 커밋 포인트
```bash
git commit -m "feat(service): wrap blocking calls with Virtual Threads"
git commit -m "feat(scheduler): add bounded elastic scheduler for blocking ops"
git commit -m "feat(adapter): add legacy system adapter with VT"
git tag -a v2.1.1 -m "v2.1.1: Blocking Code Wrapper"
```

## v2.1.2: 외부 API 병렬 호출

### 작업 내용
| 순서 | 작업 | 핵심 파일 |
|------|------|----------|
| 2.1.2.1 | ExternalApiClient | `ExternalApiClient.java` |
| 2.1.2.2 | Structured Concurrency | `ConcurrencyUtils.java` |
| 2.1.2.3 | 동시성 제한 | `Semaphore` |

### 커밋 포인트
```bash
git commit -m "feat(external): add external API client with VT"
git commit -m "feat(concurrency): add structured concurrency utilities"
git commit -m "feat(limit): add concurrency limiter for external calls"
git tag -a v2.1.2 -m "v2.1.2: Virtual Threads Integration Complete"
```

## Virtual Threads vs Platform Threads

| 항목 | Platform Threads | Virtual Threads |
|------|------------------|-----------------|
| 생성 비용 | 높음 (~1MB 스택) | 낮음 (~KB 스택) |
| 컨텍스트 스위칭 | OS 레벨 | JVM 레벨 |
| 동시성 한계 | 수천 개 | 수백만 개 |
| 블로킹 I/O | 스레드 점유 | 자동 언마운트 |
```
