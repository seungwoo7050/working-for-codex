# 프로젝트 초기화 설계 (v0.1.0)
> CMake/vcpkg 기반 프로젝트 구조 설정

**상태**: ✅ 완료

## 1. 개요

### 1.1 목표

Checkpoint A 듀얼 게임 서버를 위한 프로젝트 기반 구조 설정:
- CMake 빌드 시스템 구성
- vcpkg 의존성 관리
- 표준 C++ 프로젝트 구조

### 1.2 패치 내용

| 패치 ID | 작업 | 핵심 파일 | 상태 |
|---------|------|----------|------|
| 0.1.1 | CMakeLists.txt 설정 | `server/CMakeLists.txt` | ✅ |
| 0.1.2 | vcpkg.json 의존성 정의 | `server/vcpkg.json` | ✅ |
| 0.1.3 | 디렉토리 구조 생성 | `server/src/`, `server/include/` | ✅ |
| 0.1.4 | 빌드 환경 구성 | VSCode task, Docker | ✅ |

---

## 2. CMake 구성 (0.1.1)

### 2.1 CMakeLists.txt 구조

```cmake
cmake_minimum_required(VERSION 3.20)

# vcpkg 툴체인 자동 감지
if(DEFINED ENV{VCPKG_ROOT})
    set(CMAKE_TOOLCHAIN_FILE "$ENV{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake" CACHE STRING "" FORCE)
endif()

project(pvpserver VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra")

# 커버리지 옵션 (테스트 시 활성화)
option(ENABLE_COVERAGE "Enable coverage" OFF)
if(ENABLE_COVERAGE AND CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
    add_compile_options(--coverage -O0 -g)
    add_link_options(--coverage)
endif()

# 패키지 검색 (vcpkg CONFIG 모드)
find_package(Boost REQUIRED COMPONENTS system)
find_package(libpq CONFIG)
if(NOT libpq_FOUND)
    find_package(PostgreSQL REQUIRED)
    add_library(libpq::pq ALIAS PostgreSQL::PostgreSQL)
endif()
find_package(Protobuf REQUIRED)

# Include directories
include_directories(${CMAKE_SOURCE_DIR}/include)

# Subdirectories
enable_testing()
add_subdirectory(src)
add_subdirectory(tests)
```

### 2.2 설계 결정

- **C++17**: 게임 서버 표준, 한국 업계 요구사항 매칭
- **CMake 3.20+**: 현대적 CMake 관용구 지원
- **vcpkg 통합**: 크로스 플랫폼 의존성 관리
- **커버리지 지원**: `ENABLE_COVERAGE` 옵션으로 테스트 커버리지 측정 가능
- **PostgreSQL 호환성**: libpq 또는 PostgreSQL 패키지 자동 감지

---

## 3. 의존성 정의 (0.1.2)

### 3.1 vcpkg.json

```json
{
  "name": "cpp-pvp-server",
  "version": "1.0.0",
  "$schema": "https://raw.githubusercontent.com/microsoft/vcpkg-tool/main/docs/vcpkg.schema.json",
  "dependencies": [
    "boost-system",
    "boost-asio",
    "boost-beast",
    "gtest",
    "protobuf",
    "libpq"
  ]
}
```

### 3.2 의존성 역할

| 패키지 | 역할 | MVP | 상태 |
|--------|------|-----|------|
| boost-system | 시스템 오류 처리 | 1.0 | ✅ |
| boost-asio | 비동기 I/O (TCP/UDP) | 1.0+ | ✅ |
| boost-beast | WebSocket/HTTP | 1.0 | ✅ |
| gtest | 단위 테스트 | 1.0 | ✅ |
| protobuf | 직렬화 (예정) | 2.0+ | ✅ |
| libpq | PostgreSQL 클라이언트 | 1.0 | ✅ |

---

## 4. 디렉토리 구조 (0.1.3)

```
cpp-pvp-server/
├── server/
│   ├── CMakeLists.txt
│   ├── vcpkg.json
│   ├── src/
│   │   ├── CMakeLists.txt
│   │   ├── main.cpp
│   │   ├── core/           # 게임 루프, 설정
│   │   ├── game/           # 게임 로직
│   │   ├── network/        # 네트워크 레이어 (WebSocket/UDP)
│   │   ├── storage/        # 데이터 영속화
│   │   ├── matchmaking/    # 매치메이킹 (v1.2+)
│   │   ├── stats/          # 통계/랭킹 (v1.3+)
│   │   ├── netcode/        # 넷코드 시스템 (v1.4+)
│   │   ├── distributed/    # 분산 시스템 (v2.0+)
│   │   ├── anticheat/      # 안티치트 (v2.1+)
│   │   └── monitoring/     # 관측성 (확장용)
│   ├── include/
│   │   └── pvpserver/      # 공개 헤더
│   │       ├── core/
│   │       ├── game/
│   │       ├── network/
│   │       ├── storage/
│   │       ├── matchmaking/
│   │       ├── stats/
│   │       ├── netcode/
│   │       ├── distributed/
│   │       └── anticheat/
│   └── tests/
│       ├── unit/
│       ├── integration/
│       └── performance/
├── design/                 # 설계 문서
├── docs/                   # 문서 및 증거
│   ├── mvp-specs/          # MVP 상세 스펙
│   └── evidence/           # 성능 증거
├── monitoring/             # Prometheus/Grafana
│   ├── prometheus/
│   └── grafana/
├── deployments/            # Docker/K8s
│   └── docker/
├── expansion/              # 확장 문서
│   ├── complete/           # 완료된 확장
│   └── not-yet/            # 미완료 확장
├── snapshots/              # 버전별 스냅샷
├── scripts/                # 유틸리티 스크립트
│   ├── format.sh           # 코드 포맷팅
│   └── check-format.sh     # 포맷 검사
└── tools/                  # 테스트 클라이언트
    └── test_client.py
```

---

## 5. 빌드 환경 구성 (0.1.4)

### 5.1 VSCode Task 설정

프로젝트는 VSCode task를 통해 빌드됩니다:

**.vscode/tasks.json:**
```json
{
  "label": "Build pvpserver",
  "type": "shell",
  "command": "cd /path/to/cpp-pvp-server/server && mkdir -p build && cd build && cmake .. && make -j4",
  "isBackground": false,
  "group": "build"
}
```

### 5.2 빌드 명령어

```bash
# 수동 빌드
cd server
mkdir -p build
cd build
cmake .. -DCMAKE_TOOLCHAIN_FILE=$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake
cmake --build . --parallel $(nproc)

# 커버리지 활성화 빌드
cmake .. -DENABLE_COVERAGE=ON
cmake --build . --parallel $(nproc)
```

### 5.3 코드 포맷팅 스크립트

**scripts/format.sh:**
```bash
#!/usr/bin/env bash
set -euo pipefail
mapfile -t FILES < <(git ls-files '*.c' '*.cc' '*.cpp' '*.h' '*.hpp')
if (( ${#FILES[@]} )); then
  clang-format -style=file -i "${FILES[@]}"
fi
```

### 5.4 Docker 환경

**deployments/docker/docker-compose.yml**로 개발 환경 제공:
- PostgreSQL 15
- Redis 7
- Prometheus + Grafana (모니터링)

---

## 6. 완료 기준

- [x] CMake 빌드 성공
- [x] vcpkg 의존성 설치
- [x] main.cpp 기본 실행
- [x] 디렉토리 구조 생성
- [x] VSCode task 설정
- [x] 코드 포맷팅 스크립트

---

## 7. 다음 버전과의 연결

### v0.1.0에서 확립된 것
- CMake 프로젝트 빌드 시스템
- vcpkg 의존성 관리 체계
- 표준 디렉토리 구조
- 개발 환경 (VSCode task, Docker)
- 코드 품질 도구 (clang-format)

### v1.0.0에서 추가될 것
- WebSocket 서버 (Boost.Beast)
- 60 TPS 게임 루프
- 플레이어 상태 관리
- PostgreSQL 연동

### 이후 버전에서 확장될 것
- v1.1.0: 전투 시스템
- v1.2.0: 매치메이킹
- v1.3.0: 통계 & 랭킹
- v1.4.x: UDP 넷코드, 예측, 관측성
- v2.0.x: 분산 시스템
- v2.1.0: 안티치트
